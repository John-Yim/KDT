{% extends "base.html" %}
{% block content %}
<div class="w-full px-4 md:px-8 lg:px-16">
  <section class="bg-gray-800 rounded-xl p-10 shadow-md mb-10 text-white text-center">
    <h2 class="text-3xl font-bold mb-2">ğŸ§  ë‡Œì¢…ì–‘ ì´ë¯¸ì§€ ë¶„ë¥˜</h2>
    <p class="text-gray-400 mb-6">MRI ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ë‡Œì¢…ì–‘ì˜ ìœ í˜•ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤.</p>

    <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
    <div class="flex justify-center mb-6">
      <img id="preview-image"
           src="{{ uploaded_image if uploaded_image else url_for('static', filename=project.project_image_path) }}"
           alt="ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°"
           class="w-full max-w-md h-auto rounded-xl border-2 border-gray-600 shadow-md">
    </div>

    <!-- ì—…ë¡œë“œ í¼ -->
    <form method="POST" enctype="multipart/form-data" class="flex flex-col items-center space-y-4" onsubmit="injectBase64()">
      <input type="file" name="image" id="imageInput" accept="image/*"
             onchange="previewImage(this)"
             class="file:bg-purple-700 file:text-white file:px-4 file:py-2 file:rounded-lg file:border-none text-sm text-gray-300" required>

      <!-- base64 ë°ì´í„°ê°€ ë“¤ì–´ê°ˆ hidden input -->
      <input type="hidden" name="image_base64" id="imageBase64">

      <button type="submit"
              class="bg-green-600 hover:bg-green-700 px-6 py-2 rounded-lg text-white font-semibold">
        ì˜ˆì¸¡ ì‹¤í–‰
      </button>
    </form>

    <!-- ì˜ˆì¸¡ ê²°ê³¼ -->
    {% if prediction %}
    <div class="mt-8 text-center">
      <p class="text-xl font-bold text-green-400">ğŸ” ì˜ˆì¸¡ ê²°ê³¼: {{ prediction }}</p>
    </div>
    {% endif %}
  </section>
</div>

<script>
let currentBase64 = "";

function previewImage(input) {
  const file = input.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    currentBase64 = e.target.result;
    document.getElementById('preview-image').src = currentBase64;
  };
  reader.readAsDataURL(file);
}

function injectBase64() {
  if (currentBase64) {
    document.getElementById('imageBase64').value = currentBase64;
  }
}
</script>
{% endblock %}
